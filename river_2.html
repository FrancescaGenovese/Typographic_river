<html>
    <head>
        <style>

        @font-face {
            font-family: "MonoSpace_serif";
            src: url(Font/Flexi_IBM_VGA_True.ttf);
        }

        /*---------------------------------------dropdown------------------------------------------*/

        .dropbtn {

            background-color: grey;
            border-radius: 10%;
            color: black;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            margin: 3%;
        }

        .j{
            border-radius: 10%;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            margin: 8%;
        }

        
        .dropdown-content {
            display: none;
            background-color: #f1f1f1;
            min-width: 160px;
            overflow: auto;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 100;
        
        }

        .dropdown-content button {
            display: block;
            margin: auto;
            margin-bottom: 1%;
            width: 90%;
            
        }
        
        
        .show {display: block;}

        /*-----------------------------------------------------fine dropdown---------------------------------------*/

        .commands{
            display: flex;
            width: 100%;
        }

        .b{
            background-color: black;
            color: white;
            padding: 8px;
            font-size: 14px;
            border-radius: 5%;
            border: none;
            cursor: pointer;
            margin: 1%;
        }

        #container_all{
            

        }

       

        .grid-container {
            display: grid;
            grid-template-columns: auto auto;
  
        }

        .grid-item {
            text-align: center;
        }

        

        .Change_width_1{
            width: 50% !important;
        }

        .Change_width_2{
            width: 80% !important;
        }

        .Change_width_3{
            width: 100% !important;
        }

        .Change_font_size_1{
            font-size: 15px;
        }

        .Change_font_size_2{
            font-size: 19px;
        }

        .Change_font_size_3{
            font-size: 22px;
        }

        .Change_font_type_1{
            font-family: "Times New Roman, Times, serif" !important;
            
        }

        .Change_font_type_2{
            font-family: "MonoSpace_serif"!important;
            
        }

        .not_justify{
            text-align: left !important;
        }

        .line_height_1{
            line-height: 1.5;
        }

        .line_height_2{
            line-height: 1.6;
        }

        .line_height_3{
            line-height: 1.8;
        }
        
        </style>
    </head>

    <body>
        <div id="lines"></div>
        <div id="container_all">
                <div class="commands">
                    <div class="dropdown">
                            <button onclick="open_dropdown('myDropdown')" id="first_drop" class="dropbtn">Change the width ˇ</button>
                            <div id="myDropdown" class="dropdown-content">
                                <button class="b" onclick="ChangeWidth_1('example_1')">50%</button>
                                <button class="b" onclick="ChangeWidth_2('example_1')">80%</button>
                                <button class="b" onclick="ChangeWidth_3('example_1')">100%</button>
                            </div>
                    </div>

                    <div class="dropdown">
                        <button onclick="open_dropdown('myDropdown_1')" id="second_drop" class="dropbtn">Change font size ˇ</button>
                        <div id="myDropdown_1" class="dropdown-content">
                            <button class="b" onclick="ChangeFont_size_1('example_1')">11pt</button>
                            <button class="b" onclick="ChangeFont_size_2('example_1')">14pt</button>
                            <button class="b" onclick="ChangeFont_size_3('example_1')">16pt</button>
                            
                        </div>
                    </div>

                    <div class="dropdown">
                        <button onclick="open_dropdown('myDropdown_2')" id="th_drop" class="dropbtn">Change font type ˇ</button>
                        <div id="myDropdown_2" class="dropdown-content">
                            <button class="b" onclick="ChangeFont_type_1('example_1')">Times New Roman</button>
                            <button class="b" onclick="ChangeFont_type_2('example_1')">MonoSpace</button>
                            
                        </div>
                    </div>
                    <div class="dropdown">
                        <button onclick="open_dropdown('myDropdown_3')" id="fourth_drop" class="dropbtn">Change line height ˇ</button>
                        <div id="myDropdown_3" class="dropdown-content">
                            <button class="b" onclick="set_line_height_1('example_1')">1.5</button>
                            <button class="b" onclick="set_line_height_2('example_1')">1.6</button>
                            <button class="b" onclick="set_line_height_3('example_1')">1.7</button>
                            
                            
                        </div>
                    </div>
                    

                        <div>
                        <!--<button onclick="ChangeWidth('example_1')">Change width</button>-->
                        <!--<button class="b" onclick="ChangeFont_size('example_1')">Change font size</button>-->
                        <!--<button class="b" onclick="ChangeFont_type('example_1')">Change font type</button>-->
                        <button class="b j" onclick="Change_justify('example_1')">Not justify text</button>
                        <!--<button class="b" onclick="set_line_height('example_1')">line height</button>--->
                        <button class="b j" onClick="window.location.reload();">Delete all changements</button>
                        </div>

                </div>
                <h1>Arial, Helvetica, sans-serif - German - text justify</h1>
                <div class="grid-container">
                    <div class="grid-item">
                        <p style="font-family: Arial, Helvetica, sans-serif; width: 30%; text-align: justify; margin: auto;" id="example_1">Lorem Ipsum ist einfach nur Blindtext der Druck- und Satzindustrie. Lorem Ipsum ist seit dem 16. Jahrhundert der Standard-Dummy-Text der Branche, als ein unbekannter Drucker eine Galeere mit Schriften nahm und sie zu einem Musterbuch zusammenstellte. Sie hat nicht nur fünf Jahrhunderte, sondern auch den Sprung in den elektronischen Schriftsatz im Wesentlichen unverändert überstanden. Es wurde in den 1960er Jahren mit der Veröffentlichung von Letraset-Blättern mit Lorem Ipsum-Passagen und in jüngerer Zeit mit Desktop-Publishing-Software wie Aldus PageMaker, einschließlich Versionen von Lorem Ipsum, populär gemacht. Lorem Ipsum ist einfach nur Blindtext der Druck- und Satzindustrie. Lorem Ipsum ist seit dem 16. Jahrhundert der Standard-Dummy-Text der Branche, als ein unbekannter Drucker eine Galeere mit Schriften nahm und sie zu einem Musterbuch zusammenstellte. Sie hat nicht nur fünf Jahrhunderte, sondern auch den Sprung in den elektronischen Schriftsatz im Wesentlichen unverändert überstanden. Es wurde in den 1960er Jahren mit der Veröffentlichung von Letraset-Blättern mit Lorem Ipsum-Passagen und in jüngerer Zeit mit Desktop-Publishing-Software wie Aldus PageMaker, einschließlich Versionen von Lorem Ipsum, populär gemacht.
                        </p>
                    </div>
                    <div class="grid-item" style="text-align: left;">
                    <img  style="width: 80%;" src="esempi_rivers/tedesco_1.PNG" alt="river German">
                    </div>
                </div>
           
        </div>
        <br>
        <br>
        <br>
        <!---------------------------------------------secondo example-->
        <div id="container_all">
            <div class="commands">
                <div class="dropdown">
                        <button onclick="open_dropdown('myDropdown_4')" id="first_drop" class="dropbtn">Change the width ˇ</button>
                        <div id="myDropdown_4" class="dropdown-content">
                            <button class="b" onclick="ChangeWidth_1('example_2')">50%</button>
                            <button class="b" onclick="ChangeWidth_2('example_2')">80%</button>
                            <button class="b" onclick="ChangeWidth_3('example_2')">100%</button>
                        </div>
                </div>

                <div class="dropdown">
                    <button onclick="open_dropdown('myDropdown_5')" id="second_drop" class="dropbtn">Change font size ˇ</button>
                    <div id="myDropdown_5" class="dropdown-content">
                        <button class="b" onclick="ChangeFont_size_1('example_2')">11pt</button>
                        <button class="b" onclick="ChangeFont_size_2('example_2')">14pt</button>
                        <button class="b" onclick="ChangeFont_size_3('example_2')">16pt</button>
                        
                    </div>
                </div>

                <div class="dropdown">
                    <button onclick="open_dropdown('myDropdown_6')" id="th_drop" class="dropbtn">Change font type ˇ</button>
                    <div id="myDropdown_6" class="dropdown-content">
                        <button class="b" onclick="ChangeFont_type_1('example_2')">Times New Roman</button>
                        <button class="b" onclick="ChangeFont_type_2('example_2')">MonoSpace</button>
                        
                    </div>
                </div>
                <div class="dropdown">
                    <button onclick="open_dropdown('myDropdown_7')" id="fourth_drop" class="dropbtn">Change line height ˇ</button>
                    <div id="myDropdown_7" class="dropdown-content">
                        <button class="b" onclick="set_line_height_1('example_2')">1.5</button>
                        <button class="b" onclick="set_line_height_2('example_2')">1.6</button>
                        <button class="b" onclick="set_line_height_3('example_2')">1.7</button>
                        
                        
                    </div>
                </div>
                

                    <div>
                    <!--<button onclick="ChangeWidth('example_1')">Change width</button>-->
                    <!--<button class="b" onclick="ChangeFont_size('example_1')">Change font size</button>-->
                    <!--<button class="b" onclick="ChangeFont_type('example_1')">Change font type</button>-->
                    <button class="b j" onclick="Change_justify('example_2')">Not justify text</button>
                    <!--<button class="b" onclick="set_line_height('example_1')">line height</button>--->
                    <button class="b j" onClick="window.location.reload();">Delete all changements</button>
                    </div>

            </div>
            <h1>Arial, Helvetica, sans-serif - English</h1>
            <div class="grid-container">
                <div class="grid-item">
                    <p style="font-family: Arial, Helvetica, sans-serif; width: 30%; text-align: justify; margin: auto;" id="example_2">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.
                        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.
                    </p>
                </div>
                <div class="grid-item" style="text-align: left;">
                <img  style="width: 80%;" src="esempi_rivers/inglese_1.PNG" alt="river German">
                </div>
            </div>
       
    </div>
    <br>
    <br>
    <br>
    <!---------------------------------------------terzo example-->
    <div id="container_all">
        <div class="commands">
            <div class="dropdown">
                    <button onclick="open_dropdown('myDropdown_8')" id="first_drop" class="dropbtn">Change the width ˇ</button>
                    <div id="myDropdown_8" class="dropdown-content">
                        <button class="b" onclick="ChangeWidth_1('example_3')">50%</button>
                        <button class="b" onclick="ChangeWidth_2('example_3')">80%</button>
                        <button class="b" onclick="ChangeWidth_3('example_3')">100%</button>
                    </div>
            </div>

            <div class="dropdown">
                <button onclick="open_dropdown('myDropdown_9')" id="second_drop" class="dropbtn">Change font size ˇ</button>
                <div id="myDropdown_9" class="dropdown-content">
                    <button class="b" onclick="ChangeFont_size_1('example_3')">11pt</button>
                    <button class="b" onclick="ChangeFont_size_2('example_3')">14pt</button>
                    <button class="b" onclick="ChangeFont_size_3('example_3')">16pt</button>
                    
                </div>
            </div>

            <div class="dropdown">
                <button onclick="open_dropdown('myDropdown_10')" id="th_drop" class="dropbtn">Change font type ˇ</button>
                <div id="myDropdown_10" class="dropdown-content">
                    <button class="b" onclick="ChangeFont_type_1('example_3')">Times New Roman</button>
                    <button class="b" onclick="ChangeFont_type_2('example_3')">MonoSpace</button>
                    
                </div>
            </div>
            <div class="dropdown">
                <button onclick="open_dropdown('myDropdown_11')" id="fourth_drop" class="dropbtn">Change line height ˇ</button>
                <div id="myDropdown_11" class="dropdown-content">
                    <button class="b" onclick="set_line_height_1('example_3')">1.5</button>
                    <button class="b" onclick="set_line_height_2('example_3')">1.6</button>
                    <button class="b" onclick="set_line_height_3('example_3')">1.7</button>
                    
                    
                </div>
            </div>
            

                <div>
                <!--<button onclick="ChangeWidth('example_1')">Change width</button>-->
                <!--<button class="b" onclick="ChangeFont_size('example_1')">Change font size</button>-->
                <!--<button class="b" onclick="ChangeFont_type('example_1')">Change font type</button>-->
                <button class="b j" onclick="Change_justify('example_3')">Not justify text</button>
                <!--<button class="b" onclick="set_line_height('example_1')">line height</button>--->
                <button class="b j" onClick="window.location.reload();">Delete all changements</button>
                </div>

        </div>
        <br>
        <br>
        <br>
        <h1>Arial, Helvetica, sans-serif - Bulgarian</h1>
        <div class="grid-container">
            <div class="grid-item">
                <p style="font-family: Arial, Helvetica, sans-serif; width: 30%; text-align: justify; margin: auto;" id="example_3">Lorem Ipsum е просто фалшив текст от печатарската и наборната индустрия. Lorem Ipsum е стандартният фиктивен текст в индустрията още от 1500-те години, когато неизвестен принтер взел камбуз от шрифт и го разбъркал, за да направи книга с образци. Той е оцелял не само пет века, но и скока към електронния набор, оставайки по същество непроменен. Той беше популяризиран през 60-те години на миналия век с пускането на Letraset листове, съдържащи пасажи на Lorem Ipsum, а напоследък и със софтуер за настолни публикации като Aldus PageMaker, включително версии на Lorem Ipsum. Lorem Ipsum е просто фалшив текст от печатарската и наборната индустрия. Lorem Ipsum е стандартният фиктивен текст в индустрията още от 1500-те години, когато неизвестен принтер взел камбуз от шрифт и го разбъркал, за да направи книга с образци. Той е оцелял не само пет века, но и скока към електронния набор, оставайки по същество непроменен. Той беше популяризиран през 60-те години на миналия век с пускането на Letraset листове, съдържащи пасажи на Lorem Ipsum, а напоследък и със софтуер за настолни публикации като Aldus PageMaker, включително версии на Lorem Ipsum.
                </p>
            </div>
            <div class="grid-item" style="text-align: left;">
            <img  style="width: 80%;" src="esempi_rivers/bulgaro_1.PNG" alt="river German">
            </div>
        </div>
    </div>

        <script>
            function ChangeWidth_1(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_width_1");
            }

            function ChangeWidth_2(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_width_2");
            }

            function ChangeWidth_3(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_width_3");
            }

            function ChangeFont_size_1(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_font_size_1");
            }

            function ChangeFont_size_2(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_font_size_2");
            }

            function ChangeFont_size_3(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_font_size_3");
            }

            function ChangeFont_type_1(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_font_type_1");
            }

            function ChangeFont_type_2(id) {
               var element = document.getElementById(id);
               element.classList.toggle("Change_font_type_2");
            }


            function Change_justify(id) {
               var element = document.getElementById(id);
               element.classList.toggle("not_justify");
            }

            function set_line_height_1(id) {
               var element = document.getElementById(id);
               element.classList.toggle("line_height_1");
            }

            function set_line_height_2(id) {
               var element = document.getElementById(id);
               element.classList.toggle("line_height_2");
            }

            function set_line_height_3(id) {
               var element = document.getElementById(id);
               element.classList.toggle("line_height_3");
            }


        </script>

        <script>
            /* When the user clicks on the button, 
            toggle between hiding and showing the dropdown content */
            function open_dropdown(id) {
            document.getElementById(id).classList.toggle("show");
            }

           /* function myFunction_1() {
            document.getElementById("myDropdown_1").classList.toggle("show");
            }

            function myFunction_2() {
            document.getElementById("myDropdown_2").classList.toggle("show");
            }

            function myFunction_3() {
            document.getElementById("myDropdown_3").classList.toggle("show");
            }*/
        </script>

        <script>
        //trova indici(posizione) spazi nel testo
        function findSpacesInsideString(string){
            const indices = [];
            for(var i=0; i<string.length;i++) {
                if (string[i] === " ") indices.push(i);
            }
            return indices;
        }

        //crea range per ogni spazio e trova dove iniza e finisce, altezza, cordinate x e y
        function findClientRectsFromSpaceIndexes(el, indexes){
            const ranges = {};
            for (var i=0; i < indexes.length - 1; i++){
                const index = indexes[i];
                const r = document.createRange();
                r.setStart(el, index);
                r.setEnd(el, index + 1);
                const cr = r.getClientRects();

                if (!ranges[cr[0].y]) ranges[cr[0].y] = [];
                ranges[cr[0].y].push(cr[0]);

            }
            return ranges;
        }

        //considera due spazi, se due cordinate x dei due spazi sono vicine, l'algoritmo gli considra come river (restituisce true o false). 
        function checkIfRivers(a, b){
            // remember to check width
            return Math.abs(a.x - b.x) < 10;
        }

        var control = false;

        function draw_red_lines(a,b){
            if (control) return
            control = true
            var tag = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            //tag.setAttribute("width", '50');
            //tag.setAttribute("height", '100');
            tag.setAttribute("style", 'position:absolute');
            var line = document.createElement("line");
            // line.setAttribute("x1", (a.x).toFixed(2));
            // line.setAttribute("y1", (a.y).toFixed(2));
            // line.setAttribute("x2", (b.x).toFixed(2));
            // line.setAttribute("y2", (b.y).toFixed(2));
            line.setAttribute("x1", '100');
            line.setAttribute("y1", '300');
            line.setAttribute("x2", '200');
            line.setAttribute("y2", '500');
            line.setAttribute("style", 'stroke:rgb(255,0,0);stroke-width:2');
            tag.appendChild(line);
            var element = document.getElementById("lines");
            element.appendChild(tag);

        }

        //prende un oggetto che contine gli spazi, raggruppati per riga. c'è un indice che conta il numero di righe. 
        //(mi fermo due righe prima per non uscire numero dal numero di righe).
        //ciclo righe, considero prima riga con primo spazio poi altra riga successiva con altri spazi. Confronto primo elemento della prima riga con tutti gli spazi della riga successiva.
        //Se questi sono un river allora devo capire se ho già visto il primo dei due, cerco dove si trova. 
        function findRivers(client_rects){
            const result = [];
            let index = 0;
            const keys  = Object.keys(client_rects);
            while (index < keys.length - 2){
                for (var i = 0; i < client_rects[keys[index]].length; i++){
                    const space_a = client_rects[keys[index]][i];
                    for (var j = 0; j < client_rects[keys[index + 1]].length; j++){
                        const space_b = client_rects[keys[index + 1]][j];
                        if (checkIfRivers(space_a, space_b)) {
                            draw_red_lines(space_a, space_b)
                            let found = false;
                            for (var z = 0; z < result.length && !found; z++){
                                for (var t = 0; t < result[z].length; t++){
                                    if (result[z][t].x == space_a.x && result[z][t].y == space_a.y){
                                        found = true;
                                        result[z].push(space_b);
                                        break;
                                    }
                                }
                            }

                            if (!found){
                                result.push([space_a, space_b]);
                            }
                        }
                    }
                }
                index++;
            }
            //Result è un array che contiene tutti i rivers raggruppati in sequenza.
            return result;
        }

        //Per eliminare i river composti da meno di tre spazi.
        function filterRivers(rivers){
            const result = [];
            for (var i = 0; i < rivers.length; i++){
                if (rivers[i].length > 2) result.push(rivers[i]);
            }
            return result;
        }


		const example = document.getElementsByTagName('p');
        var i;
        for (i = 0; i < example.length; i++){
            const space_indexes = findSpacesInsideString(example[i].innerHTML);
            const client_rects = findClientRectsFromSpaceIndexes(example[i].childNodes[0], space_indexes);
            console.log("space_indexes", space_indexes);
            console.log("client_rects", client_rects);
            const rivers = findRivers(client_rects)
            console.log("rivers", filterRivers(rivers));

        }
        </script>
       
    </body>
</html>